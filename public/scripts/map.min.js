/*! ten20homepage 2013-07-23 */
window.ten20=window.ten20||{},window.ten20.MapRender=function(){function a(a,b){this.mapDiv=a;for(var c in b)this[c]=b[c];this.markers=[],this.polylines=[],this.init()}function b(a,b){return Math.random()*(b-a)+a}function c(a){var c;return c=void 0===a?b(-.001,.001):a+b(-5e-4,5e-4)}function d(a){var b=a.getLatLng();a.latDelta=c(a.latDelta),a.lngDelta=c(a.lngDelta),a.setLatLng([b.lat+a.latDelta,b.lng+a.lngDelta])}function e(a){for(var b=[],d=[a.getLatLng().lat,a.getLatLng().lng],e=0;20>e;e++)b.unshift([d[0],d[1]]),a.latDelta=c(a.latDelta),a.lngDelta=c(a.lngDelta),d[0]+=a.latDelta,d[1]+=a.lngDelta;return b}function f(a){var b=a.history.getLatLngs();b.push(a.getLatLng()),b.length>100&&b.shift(),a.history.setLatLngs(b)}var g={stroke:!0,weight:6,color:"#eee",fillColor:"#f60",fillOpacity:1},h={stroke:!0,weight:1,color:"#f60",fillColor:"#f60",fillOpacity:1,radius:100,fillOpacity:.2},i={stroke:!1,weight:1,fillColor:"#f60",fillOpacity:1,radius:2};return a.prototype.init=function(){var a=this,b={};if(L.mapbox.config.HTTPS_URLS=["https://dnv9my2eseobd.cloudfront.net/v3/"],L.mapbox.config.FORCE_HTTPS=!0,this.map=L.mapbox.map(this.mapDiv,this.tile,{zoomControl:this.zoomControl}),this.layers){for(var c=0;c<this.layers.length;c++){var d=this.layers[c];b[d.label]=L.mapbox.tileLayer(d.tileLayer)}L.control.layers(b).addTo(this.map)}this.map.setView([this.lat,this.lng],this.zoomLevel),this.map.scrollWheelZoom.disable(),this.setupVirtualFence(),this.addMarkers(),setInterval(function(){a.updateNextMarker()},2e3);var e=$(".leaflet-control-layers-base label");e.on("click",function(){$(this).parent().children().removeClass("active"),$(this).addClass("active"),$(this).is(":last-child")?$(".leaflet-control-layers-list").addClass("darker"):$(".leaflet-control-layers-list").removeClass("darker")}),e.first().click()},a.prototype._getRandomVisibleLatLng=function(){var a=this.map.getBounds(),c=b(a.getNorth(),a.getSouth()),d=b(a.getWest(),a.getEast());return[c,d]},a.prototype.getMapObject=function(){return this.map},a.prototype.addPolyline=function(a){var b={stroke:!0,weight:2,color:"#f60",dashArray:"3,4",smoothFactor:1},c=L.polyline(a,b).addTo(this.map);return c},a.prototype.addMarkers=function(){for(var a=0;a<this.numberOfTrackers;a++){var b=this._getRandomVisibleLatLng(),c=L.circleMarker(b,g).addTo(this.map);if(this.showHistory){var d=e(c);c.history=this.addPolyline(d)}this.map.addLayer(c),this.markers.push(c)}},a.prototype.updateNextMarker=function(){if(0!=this.markers.length){(void 0===this.currentMarkerIndex||this.currentMarkerIndex===this.markers.length)&&(this.currentMarkerIndex=0);var a=this.markers[this.currentMarkerIndex];d(a),this.twinkleMarker(a),this.showHistory&&f(a),this.followFirstTracker&&this.markers.length>0&&this.map.panTo(this.markers[0].getLatLng()),this.currentMarkerIndex++}},a.prototype.setupVirtualFence=function(){if(this.addVirtualFence){var a=this.map.getCenter();L.circleMarker(a,h).addTo(this.map),L.circleMarker(a,i).addTo(this.map)}},a.prototype.twinkleMarker=function(a){var b=[10,13,16,19,22,21,20,19,18,17,16,15,14,13,12,11],c=0,d=setInterval(function(){c==b.length-1?clearInterval(d):c++,a.setRadius(b[c])},100)},a}();