<div class="page-wrapper">
  <!-- map render elem -->
  <div id="map" user-map>
    <button class="btn btn-default navbar-btn" data-toggle="collapse" data-target=".navbar-collapse" ng-click="toggleMapWidth()">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <!-- tool box -->
  <div class="tool-box">
    <!-- general user info --> 
    <div class="time-weather">
      <span ng-bind="timeWeather"></span>
      <!--<a class="info"><img src="/images/user/info-big.png"/></a>-->
    </div>
    <div class="welcome"><img src="/images/logo.png" class="logo"/>
      <span>Welcome {{user.username}}</span>
    </div>

    <!-- trackers accordion -->
    <accordion close-others="true" class="tracker-list">
      <accordion-group is-open="isopen" ng-class="{opened: isopen}" ng-repeat="tracker in trackers">

        <accordion-heading>
          <span class="first">{{tracker.name | limitTo:18}}</span>
          <span class="dropdown"></span>
        </accordion-heading>

        <div class="tracker-content">
          <tabset>
            <tab class="info-tab">
              <tab-heading class="tracker-info">
                <img src="/images/user/info-whiter.png"/>
                <span>info</span>
              </tab-heading>
              <div class="media">
                <!--<img src="/images/user/avatar.png" class="pull-left avatar"/>
                <div class="media-body">
                  <h6 ng-bind="tracker.location.city"></h6>
                  <h6 ng-bind="tracker.location.weather"></h6>
                  <h6>{{tracker.lastMessage.location.timestamp | timeFormat: 'date'}}</h6>
                </div>
                -->
              </div>
              <div class="current-info">
                <h6>latest activity:</h6>
                <span>{{tracker.lastUpdate | timeFormat: 'date'}}</span>
                <span>{{tracker.lastUpdate | timeFormat: 'time'}}</span>
                <h6>latitude:<span>{{tracker.lastMessage.location.latitude | number:4 || '--'}}</span></h6>
                <h6>longitude:<span>{{tracker.lastMessage.location.longitude | number:4 || '--'}}</span></h6>
                <h6>current speed:<span>{{tracker.lastMessage.location.speed || '--'}}</span></h6>
              </div>
            </tab>

            <tab class="history-tab">
              <tab-heading class="tracker-history">
                <img src="/images/user/trip-small.png"/>
                <span>trip</span>
              </tab-heading>
              <div class="date-select">

                <div class="search">
                  <input type="text" ng-bind="tracker.trip.search" show-weeks="false" datepicker-popup="dd-MMMM-yyyy" ng-model="tracker.trip.search" show-button-bar="false" close-text="Close" placeholder="Search date or place"/>
                  <img src="/images/user/search.png" ng-click="open($event)"/>
                </div>

                <div class="trip-list">
                  <ul>
                    <li ng-repeat="item in tracker.trips.data"
                    ng-click="showTrip(tracker, $index)"
                    ng-class="{active : $index === tracker.trips.active}">
                    <h6><span class="header">started</span><span class="timeslot">{{item.startTime | tripTime}}</span></h6>
                    <h6><span class="header">ended</span><span class="timeslot">{{item.endTime | tripTime}}</span></h6>
                    </li>
                  </ul>
                  <h6 class="error" ng-show="tracker.trips.error !=''">{{tracker.trips.error}}</h6>
                </div>

                <div class="trip-load">
                  <button class="btn btn-default" ng-hide="tracker.trips.loading || tracker.trips.error !== ''" ng-click="loadTrips(tracker)">more</button>
                  <img  ng-show="tracker.trips.loading" src="/images/loading_bar.gif" alt="" />
                </div>

              </div>
            </tab>
          </tabset>
        </div>

        <div class="tracker-bottom">
          <img src="/images/user/setting.png" model-form src-model="tracker" tpl-url="/templates/trackerSetting.html" method="PATCH" path="/trackers/{{tracker._id}}" dialog-class="small" request-prop="settings"/>
        </div>

      </accordion-group>
    </accordion>

    <div class="add-tracker" ng-show="trackerLoaded && trackers.length == 0">
      <button class="btn btn-default" model-form src-model="tracker" tpl-url="/templates/trackerSetting.html" method="PUT" path="/trackers" dialog-class="small" >add tracker</button>
    </div>
  </div>

  <!-- bottom nav -->
  <ul class="bottom-nav">
    <li><span><a href="/signout">signout</a></span></li>
    <li><span><a model-form src-model="user" tpl-url="/templates/userSetting.html" method="PATCH" path="/users/{{user._id}}" dialog-class="small">my account</a></span></li>
    <li><span><a href="/#help">help</a></span></li>
  </ul>
</div>
