extends layout-angular

block content
  section.map-canvas(ng-controller='UserCtrl')
    #map
      .tool-box
        .time-weather
          span(ng-bind='timeWeather')
          a.info
            img(src='/images/user/info-big.png')

        .welcome
          img.logo(src='/images/logo.png')
          span.info welcome
          span(ng-bind='user.name')


        ul.tracker-list
          li(ng-repeat='tracker in trackers')
            .tracker-header(ng-click='setActiveTracker($index)')
              span.first tracker
              span(ng-bind='tracker.id')
              span.dropdown
            .tracker-content(ng-class='trackers[$index].activeTab')
              ul.tabs
                li.tracker-info(ng-click='hideHistoryTrip()')
                    img(src='/images/user/info-whiter.png')
                    | tracker info

                li.tracker-history(ng-click='showHistoryTrip(0)')
                    img(src='/images/user/trip-small.png')
                    | trip history

              .tracker-bottom
                img(src='/images/user/setting.png')(ng-click='setUp')

              .tabs-content
                .info-tab
                  .media
                    img.pull-left.avatar(src="/images/user/avatar.png")
                    .media-body
                      h6(ng-bind='tracker.location.city')
                      h6(ng-bind='tracker.location.date')
                      h6(ng-bind='tracker.location.time')
                      h6(ng-bind='tracker.location.weather')
                  .current-info
                    h6 virtual fence:
                      span(ng-bind='tracker[fence]')
                    h6 latest activity:
                      span(ng-bind='tracker[lastUpdateTimestamp]')
                    h6 latitude:
                      span(ng-bind='tracker[latitude]')
                    h6 longitude:
                      span(ng-bind='tracker[longitude]')
                    h6 course:
                      span(ng-bind='tracker[course]')
                    h6 current speed:
                      span(ng-bind='tracker[speed]')

                .history-tab
                  .date-select
                    .media
                      img.pull-left(src='/images/user/trip.png')
                      .media-body
                        h6(ng-bind='tracker.history.date')
                        input.history-date(ui-date, ui-date-format="DD, d MM, yy", type='text', ng-model="tracker.history.date")
                    .search
                      img(src='/images/user/search.png')
                      input(type='text', placeholder='Search date or place')
                    
                    ul.trip-list
                      li(ng-repeat='item in tracker.history.data', ng-click='updateHistoryTrip($index)', ng-class='{active : isHistoryItemSelected($index)}')
                        span time:
                        span.timeslot(ng-bind='item.time')
                        img(src='/images/user/info-small.png')


      ul.bottom-nav
        li
          span +
            a(href='/signout')= logout
        li
          span +
            a(href="/#tracker")= trackers
        li
          span +
            a(href="/#setting")= settings
        li
          span +
            a(href="/#help")= help

    script.
      $(function() {
        $('.tool-box').draggable();
        $('.trip-info').draggable();

        // trackers list pane
        $('.tracker-list').on('click', '.tracker-header', function() {

          if (!$(this).parent().hasClass('active')) {
            var activeTracker = $('.tracker-list > .active').children('.tracker-content');

            $('.tracker-list > .active').removeClass('active');

            if ($(window).height() > 800) {
              activeTracker.slideToggle();
            } else {
              activeTracker.hide();
            }
          }

          $(this).parent().toggleClass('active');

          if ($(window).height() > 800) {
            $(this).next().slideToggle();
          } else {
            $(this).next().animate({width: 'toggle'});
          }
        });

        $('.tracker-list').on('focusTracker', function(e, index) {
          var $tracker = $(this).find('.tracker-header').eq(index);

          // if not the active tracker, then switch to active
          if (!$tracker.parent().hasClass('active')) {
            $tracker.click();
          }
        });

      });
